#!/usr/bin/env bash

export PLAYBOOK="ansible-playbook -i ${DIR}/orchestration/hosts --user=${USER} ${DIR}/orchestration"
export EXTRA_VARS="--extra-vars ansible_sudo_pass=${USER}"

run_tests() {
  # echo -e "${BLUE}Running the system test suite...${COLOR_ENDING}"
  # ${PLAYBOOK}/system-tests.yml ${EXTRA_VARS}

  echo -e "${BLUE}Running the reverse proxy test suite...${COLOR_ENDING}"
  ${PLAYBOOK}/reverse-proxy-tests.yml ${EXTRA_VARS}
  # 
  # echo -e "${BLUE}Running the database test suite...${COLOR_ENDING}"
  # ${PLAYBOOK}/db-tests.yml ${EXTRA_VARS}
  #
  # echo -e "${BLUE}Running the web test suite...${COLOR_ENDING}"
  # ${PLAYBOOK}/web-tests.yml ${EXTRA_VARS}
}

import_site() {
  echo -e "${BLUE}Importing site into new docroot ${SITENAME}...${COLOR_ENDING}"
  ${PLAYBOOK}/import.yml --extra-vars "ansible_sudo_pass=${USER} import=Y sitename=${SITENAME}"
}

delete_site() {
  echo -e "${BLUE}Deleting docroot ${SITENAME}...${COLOR_ENDING}"
  ${PLAYBOOK}/delete.yml --extra-vars "ansible_sudo_pass=${USER} delete=Y sitename=${SITENAME}"
}

reinstall_drupal() {
  echo -e "${BLUE}Reinstalling Drupal...${COLOR_ENDING}"
  ${PLAYBOOK}/reinstall.yml --extra-vars "ansible_sudo_pass=${USER} reinstall=Y"
}

drupal_dev_mode() {
  echo -e "${BLUE}Configuring Drupal for development...${COLOR_ENDING}"
  ${PLAYBOOK}/dev.yml --extra-vars "ansible_sudo_pass=${USER} dev=Y"
}

drupal_prod_mode() {
  echo -e "${BLUE}Configuring Drupal for production...${COLOR_ENDING}"
  ${PLAYBOOK}/prod.yml --extra-vars "ansible_sudo_pass=${USER} prod=Y"
}

run_base_container_orchestration() {
  echo -e "${BLUE}Running ${BASE_CONTAINER} orchestration on the container...${COLOR_ENDING}"

  ${PLAYBOOK}/base.yml ${EXTRA_VARS}
}

run_reverse_proxy_container_orchestration() {
  echo -e "${BLUE}Running ${REVERSE_PROXY_CONTAINER} orchestration on the container...${COLOR_ENDING}"

  ${PLAYBOOK}/reverse_proxy.yml ${EXTRA_VARS}
}

run_web_container_orchestration() {
  echo -e "${BLUE}Running ${WEB_CONTAINER} orchestration on the container...${COLOR_ENDING}"

  ${PLAYBOOK}/web.yml ${EXTRA_VARS}
}

run_db_container_orchestration() {
  echo -e "${BLUE}Running ${DB_CONTAINER} orchestration on the container...${COLOR_ENDING}"

  ${PLAYBOOK}/db.yml ${EXTRA_VARS}
}

run_search_container_orchestration() {
  echo -e "${BLUE}Running ${SEARCH_CONTAINER} orchestration on the container...${COLOR_ENDING}"

  ${PLAYBOOK}/search.yml ${EXTRA_VARS}
}

run_gluster_setup_container_orchestration() {
  echo -e "${BLUE}Running GlusterFS orchestration on the container...${COLOR_ENDING}"

  ${PLAYBOOK}/gluster-setup.yml ${EXTRA_VARS}
}

run_web2_container_orchestration() {
  echo -e "${BLUE}Running ${WEB_CONTAINER} orchestration on the container...${COLOR_ENDING}"

  ${PLAYBOOK}/web2.yml ${EXTRA_VARS}

  run_gluster_setup_container_orchestration
}
